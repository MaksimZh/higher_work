# Ускоряем код фреймворков в 100 раз


## 1. Как писать код для веб-фреймворков, который работает в 100 раз быстрее
Я бы не поверил, что в серьёзных проектах кто-то использует ORM так,
как про это рассказывается в статье.
Но, блин, я видел эти сайты, которые спотыкаются при выводе любого списка.
Это и сайты госучреждений и частных компаний, и даже в сфере IT.
Самое разумное объяснение таких тормозов - это то, что там и правда
на каждый клик идёт выгрузка половины базы данных и крутятся вложенные циклы :(

Правильно думать о базе данных именно как о базе **данных**, а не объектов.
Если нам нужно именно обрабатывать данные так, как это умеет БД
(поиск, фильтрация, сортировка, некоторые простые вычисления и т.п.),
то и делать это нужно именно на стороне БД с помощью SQL запросов.
Если нужны более сложные манипуляции, какие-то нетривиальные алгоритмы,
то тогда это должны быть процедуры, которые получают данные подготовленные
самой БД настолько, насколько возможно.

Вот такое правило я для себя вывел:
 1. разбивать любую процедуру, обращающуюся к БД, на SQL и не-SQL часть;
 1. если есть сомнения куда отнести конкретный шаг обработки данных,
    его нужно отнести в SQL.


## 2. ORM в Django
В Django есть особый вид классов - модели, которые отображаются
(в математическом смысле) в таблицы БД.
Поля внутри такого класса описывают поля в соответствующей таблице
(тип данных, значение по умолчанию, и т.д.).

### Создание и модификация записей
Создание экземпляра класса-модели не меняет БД.
Для записи данных в базу нужно вызвать метод `save` у объекта,
тогда выполняется SQL запрос `INSERT`.

Если объект уже в базе данных, то вызов `save` выполняет запрос
`UPDATE`.
Если при этом мы хотим изменить только часть полей в записи,
то запрос можно оптимизировать, добавив параметр с именами этих полей:
```Python
item.save(update_fields=["field1", "field2"])
```

Если мы хотим изменить часть полей 