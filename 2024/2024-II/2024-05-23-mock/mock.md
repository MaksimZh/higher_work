# Делаем тесты хорошими

## 1. Выводы по теории
"Разделяй и властвуй" (с)

Свойства программы, которые являются независимыми на уровне логики,
должны независимо тестироваться на уровне кода тестов.
Свойство A не зависит от свойства B,
когда возможна реализация, при которой A есть, а B - нет.

Как это ни странно, даже если B явно используется в коде,
сам сценарий его использования может быть тем самым A,
которое не зависит от B, только от его интерфейса.
Простой пример - функция поиска `find(predicate, collection)`,
у которой сам алгоритм не зависит ни от конкретного `predicate`,
ни от конкретной `collection`.
Какие у неё есть свои собственные свойства?
Как на счёт такого:
```Python
assert predicate(find(predicate, collection))
```
Это если нам нужен один любой элемент, удовлетворяющий условию.
А если первый элемент?
```Python
e = find(predicate, collection)
# Условие выполняется для выбранного элемента
assert predicate(e)
# Условие не выполняется для предыдущих элементов
assert all(not predicate(e1) for e1 in collection[:e])
```
А если нам нужны все элементы?
```Python
found = find(predicate, collection)
# Условие выполняется для найденных элементов
assert all(predicate(e) for e in found)
# Условие не выполняется для остальных элементов
assert all(not predicate(e) for e in collection if e not in found)
```
И это всё для любого `predicate` и любой `collection`
с заданными (лучше - на уровне типов) интерфейсами.

Что плохого тестировать именно с теми аргументами, которые нам нужны?
Пусть `collection` - огромная выборка из БД.
А ещё нам не свезло, и `predicate` не реально включить в SQL запрос,
(иначе нам `find` бы и не понадобился).
Каждый тест будет выполняться, например, пару секунд, что неприемлемо,
если подобных тестов сотни.
Поэтому не надо тестировать `find` в связке с таким кодом,
даже если в программе он используется именно так и только так.
На помощь идут моки - простые версии `predicate` и `collection`,
для которых тест идёт считанные микросекунды
(ну ладно, в Python - миллисекунды) даже со всеми обвесами
в виде `assert all(...)`.
